<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head>
<title>../../tb/hdl/tb_zpu_core.v</title>
<link rel="Stylesheet" title="v2html stylesheet" media="Screen" href="v2html.css">
</head>
<script language="JavaScript" type="text/javascript"><!--
var agt=navigator.userAgent.toLowerCase(); 
var is_nav  = ((agt.indexOf('mozilla')!=-1) &&
(agt.indexOf('spoofer')==-1) &&
(agt.indexOf('compatible') == -1) &&
(agt.indexOf('opera')==-1) &&
(agt.indexOf('webtv')==-1)); 
var is_major = parseInt(navigator.appVersion); 
var is_nav4up = (is_nav && (is_major >= 4)); 
var is_ie     = (agt.indexOf("msie") != -1); 
var is_ie4up  = (is_ie  && (is_major >= 4)); 
var is_nav5up = (is_nav && (is_major >= 5));
var dirSep = (window.location.pathname.indexOf('\\') != -1) ? '\\' : '/' ;
function setbuttons (wndw) {
var i;
var sl=wndw.loc[ wndw.document.forms[0].elements[0].selectedIndex ];
for (i=0;i<sl.length;i++) {
if(sl[i]) wndw.document.images[i].src='v2html-b1.gif';
else      wndw.document.images[i].src='v2html-b2.gif';
}
if ( wndw.document.forms[0].elements[0].options[ 
wndw.document.forms[0].elements[0].selectedIndex ].text != '-') {
wndw.document.images[i  ].src='v2html-b1.gif';
wndw.document.images[i+1].src='v2html-b1.gif';
}
else {
wndw.document.images[i  ].src='v2html-b2.gif';
wndw.document.images[i+1].src='v2html-b2.gif';
}
}
// Unindented and uncommented to save spave - look in v2html for a prettier version
var disabled=1;
if (!is_nav4up) {
var event=false; 
}
var last_link=0;     
var last_class=null; 
function qs(e,t,extra_info_index) {
var inc=0,bnum=0,i,j;
if (disabled) return false;
var sig_buttons = [ "Definition" , "Local Driver" , 
"Up to Input Driver" , "Find Source" , "Index"];
if (is_nav4up || is_ie4up) {
if (((e.which==2) && (!(e.modifiers&Event.SHIFT_MASK))) ||
((e.which==1) &&  (e.modifiers&Event.CONTROL_MASK)))   inc = 1;
else if (((e.which==2) && (e.modifiers&Event.SHIFT_MASK)) ||
((e.which==1) && (e.modifiers&Event.SHIFT_MASK))) inc = -1;
if (inc == 0 && extra_info_index == 0) { 
return true;  
}
var linkText = is_nav4up ? t.text : t.innerText;
var linkY    = is_nav4up && ! is_nav5up ? t.y    : t.offsetTop;
window.status="Searching...";
if ((last_link==-1) || (document.links[last_link]!=t)) 
for (last_link=0;last_link<document.links.length;last_link++) 
if (document.links[last_link] == t)  
break;
if (inc != 0) { 
return search(linkText,linkY,last_link,inc,1);
}
else { 
window.status="";
extra_info_index--; 
if (extra_info[extra_info_index][0] != 'S') { 
return true;
}
var w = window.open('','SignalPopUp','width=200,height=235');
if (null != w.document.forms[0]) {
if ((window.location.pathname.substring(0,window.location.pathname.lastIndexOf(dirSep)))!=
(w.pn.substring(0,w.pn.lastIndexOf(dirSep)))) {
w.close();
w = window.open('','SignalPopUp','width=200,height=235');
}
}
w.focus(); 
if (null == w.document.forms[0]) { 
var Text = '<html><head></head>';
if (is_nav4up) { 
w.loc = new Array(10);
w.sel = null;
w.pn  = window.location.pathname;
}
else {     
Text += '<script>var loc = new Array(10);<\/script>\n';
Text += '<script>var sel;<\/script>\n';
Text += '<script>var pn = opener.location.pathname;<\/script>\n';
}
Text += '<body bgcolor="white">\n';
Text += '<form>';
Text += '  <select onchange="opener.setbuttons(window);">\n';
Text += '  <option>---------------------------</option>\n';
for (j=0;j<9;j++) Text += '  <option>-</option>\n';
Text += '  </select>\n';
Text += '</form>';
Text += '<table cellspacing=0 cellpadding=0>\n';
for (var i=0;i<(extra_info[extra_info_index].length-1);i++) {
Text += hbutton(sig_buttons[i], 
'opener.location=loc[sel.selectedIndex]['+i+'];',
bnum++);
}
Text += hbutton("Search Backwards", 
'opener.search(sel.options[ sel.selectedIndex ].text,' +
'0,opener.last_link,-1,0);',bnum++);
Text += hbutton("Search Forwards",
'opener.search(sel.options[ sel.selectedIndex ].text,' +
'0,opener.last_link, 1,0);',bnum++);
Text += hbutton("Close","window.close();",bnum++);
Text += '</table>\n';
Text += '</body></html>\n';
w.document.open();
w.document.write(Text);
w.document.close();
w.document.forms[0].elements[0].options[0].text  = linkText;
w.sel = w.document.forms[0].elements[0]; 
for (j=0;j<10;j++) w.loc[j] = new Array(sig_buttons.length);  
copy_into_loc0(w,extra_info_index);
}
else {
var opts = w.document.forms[0].elements[0].options;
if ( opts.length<10 ) { 
w.loc[opts.length] = new Array;
opts.length++; 
}
for (i=opts.length-2;i>=0;i--) {
opts[i+1].text=opts[i].text;
for (var j=0;j<w.loc[i].length;j++) w.loc[i+1][j] = w.loc[i][j];
}
opts[0].text  = linkText;
copy_into_loc0(w,extra_info_index);
}
return false; 
}
}
return true;
}
function hbutton (text,action,bnum) {
return '  <tr><td><a href="" '+
'onmousedown="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
'images['+bnum+'].src=\'v2html-b3.gif\';" '+
'onmouseup="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
'images['+bnum+'].src=\'v2html-b1.gif\';" '+
'onclick="'+
'if (images['+bnum+'].src.match(/v2html-b2.gif/)) return false; ' +
action + 
' return false;">'+
'<img border=0 src="v2html-b1.gif"></a></td>' +
'<td style="font-family:sans-serif; font-weight:bold; font-size:14px;"> '+text+'</td></tr>\n';
}
function copy_into_loc0 (w,extra_info_index) {
for (var i=1;i<extra_info[extra_info_index].length;i++) {
w.loc[0][i-1] = extra_info[extra_info_index][i];
}
w.document.forms[0].elements[0].selectedIndex=1;
w.document.forms[0].elements[0].selectedIndex=0;
setbuttons(w);
}
function search(text,y,i,inc,relative) {
var nextpage,wrappage,linkText,linkY;
window.status="Searching...";
if (last_class) document.links[i].className=last_class;
while (1) {
for (i+=inc;i<document.links.length && i>=0;i+=inc) {
linkText = is_nav4up ? document.links[i].text : document.links[i].innerText;
linkY    = is_nav4up && ! is_nav5up ? document.links[i].y    : document.links[i].offsetTop;
if ((linkText == text) && (linkY != y)) {
window.status="";
if (is_nav4up) 
if (relative) window.scrollBy(0,linkY - y);
else          window.scrollTo(0,linkY); 
else if (is_ie4up)
document.links[i].scrollIntoView(true); 
last_link=i;
last_class=document.links[i].className;
document.links[i].className='HI';
return false;
}
}
nextpage = (inc==1) ? next_page() : prev_page();
wrappage = (inc==1) ? first_page() : last_page();
if (nextpage!="" || wrappage!="") {
if (nextpage=="") { 
if (!confirm(text + " not found. Search again from "+((inc==1)?"first":"last")+" page?"))
return false;
nextpage=wrappage;
}
location=nextpage+ "?" + escape(text) + "&" + ( y - window.pageYOffset ) + "&" + inc;
return false;
}
if (confirm(text + " not found. Search again from "+((inc==1)?"start":"end")+"?")) {
if (inc==1) i=-1;
else i=document.links.length;
} else return false;
}
return true;
}
function loadqs() {
var opt=location.search, text="", s="", y=0, si=0, inc=1;
if (opt.length==0) return true;  
for (var i=1;i<opt.length;i++) { 
if (opt.charAt(i) != "&") 
s += opt.charAt(i);
else {
if (text=="") text=unescape(s);
else             y=s;
s="";
}
}
if (text=="") return true;
if (s == "-1") { si=document.links.length-1; inc=-1; }
window.scrollTo(0,0);
search(text,y,si,inc);
return true;
}
// -->
</script>
<body onload='loadqs();'>
<script language="JavaScript"type="text/javascript"><!--
function prev_page() { return ""; }
function last_page() { return ""; }
// -->
</script>
<center><table class=NB cols=7 ><tr><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy.html';"><a target="_top" href="hierarchy.html">Hierarchy</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-f.html';"><a target="_top" href="hierarchy-f.html">Files</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-m.html';"><a target="_top" href="hierarchy-m.html">Modules</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-s.html';"><a target="_top" href="hierarchy-s.html">Signals</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-t.html';"><a target="_top" href="hierarchy-t.html">Tasks</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-fn.html';"><a target="_top" href="hierarchy-fn.html">Functions</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='http://www.burbleland.com/v2html/help_7_30.html?';"><a target="_top" href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></td></tr></table></center>
<pre>
<span class=C>// NOTES
</span><span class=C>// simple testbench for the ZPU
</span><span class=C>//
</span><span class=C>// AUTHOR
</span><span class=C>// Jurij Kostasenko
</span>
<a name="tb_zpu_core"></a><span class=K>module</span> <span class=MM>tb_zpu_core</span><a  href="hierarchy-m.html#tb_zpu_core"><img align=top border=0 alt="Index" src="v2html-i.gif"></a> ();
<span class=M>`include</span> <a  onClick="return qs(event,this,0)"  class=S href="zpu_config.v.html">&quot;zpu_config.v&quot;</a>

<a name="10"></a><span class=K>parameter</span> <a  onClick="return qs(event,this,0)"  class=PA href="#10">tty_file</a> = <span class=S>&quot;tty_zpu.txt&quot;</span>;

<a name="12"></a><span class=K>reg</span>                      <a  onClick="return qs(event,this,1)"  class=SR href="#93">clk</a>;
<span class=C>// signal  areset : std_logic;
</span><a name="14"></a><span class=K>reg</span>                      <a  onClick="return qs(event,this,2)"  class=SR href="#47">areset</a>;
<a name="15"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,3)"  class=SW href="#55">mem_busy</a>;
<a name="16"></a><span class=K>reg</span>       [wordSize-1:0] <a  onClick="return qs(event,this,4)"  class=SR href="#60">mem_read</a>;
<a name="17"></a><span class=K>wire</span>      [wordSize-1:0] <a  onClick="return qs(event,this,5)"  class=SW href="#190">mem_write</a>;
<a name="18"></a><span class=K>wire</span> [maxaddrbitincio:0] <a  onClick="return qs(event,this,6)"  class=SW href="#191">mem_addr</a>;
<a name="19"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,7)"  class=SW href="#192">mem_writeEnable</a>;
<a name="20"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,8)"  class=SW href="#193">mem_readEnable</a>;
<a name="21"></a><span class=K>wire</span>     [wordBytes-1:0] <a  onClick="return qs(event,this,9)"  class=SW href="#194">mem_writeMask</a>;
<a name="22"></a><span class=K>reg</span>                      <a  onClick="return qs(event,this,10)"  class=SR href="#78">enable</a>;
<a name="23"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,11)"  class=SW href="#23">dram_mem_busy</a>;
<a name="24"></a><span class=K>wire</span>      [wordSize-1:0] <a  onClick="return qs(event,this,12)"  class=SW href="#24">dram_mem_read</a>;
<a name="25"></a><span class=K>wire</span>      [wordSize-1:0] <a  onClick="return qs(event,this,13)"  class=SW href="#25">dram_mem_write</a>;
<a name="26"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,14)"  class=SW href="#51">dram_mem_writeEnable</a>;
<a name="27"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,15)"  class=SW href="#52">dram_mem_readEnable</a>;
<a name="28"></a><span class=K>wire</span>     [wordBytes-1:0] <a  onClick="return qs(event,this,16)"  class=SW href="#28">dram_mem_writeMask</a>;
<a name="29"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,17)"  class=SW href="#180">io_busy</a>;
<a name="30"></a><span class=K>wire</span>      [wordSize-1:0] <a  onClick="return qs(event,this,18)"  class=SW href="#181">io_mem_read</a>;

<a name="32"></a><span class=K>reg</span>       [wordSize-1:0] <a  onClick="return qs(event,this,19)"  class=SR href="#140">io_mem_read_reg</a>;

<a name="34"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,20)"  class=SW href="#53">io_mem_writeEnable</a>;
<a name="35"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,21)"  class=SW href="#54">io_mem_readEnable</a>;
<a name="36"></a><span class=K>reg</span>                      <a  onClick="return qs(event,this,22)"  class=SR href="#80">dram_ready</a>;
<a name="37"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,23)"  class=SW href="#72">io_ready</a>;
<a name="38"></a><span class=K>reg</span>                      <a  onClick="return qs(event,this,24)"  class=SR href="#79">io_reading</a>;
<a name="39"></a><span class=K>wire</span>                     <a  onClick="return qs(event,this,25)"  class=SW href="#196">break</a>;

<span class=C>// IO MAPPED ADDR
</span><a name="42"></a><span class=K>wire</span>   [maxAddrBit:minAddrBit] <a  onClick="return qs(event,this,26)"  class=SW href="#43">io_mem_addr</a>;
<a name="43"></a><span class=K>assign</span> <a  onClick="return qs(event,this,26)"  class=SW href="#42">io_mem_addr</a> = <a  onClick="return qs(event,this,6)"  class=SW href="#191">mem_addr</a>[maxAddrBit:minAddrBit];

<span class=K>initial</span>
<span class=K>begin</span>
<a name="47"></a>	<a  onClick="return qs(event,this,2)"  class=SR href="#14">areset</a>      &lt;= 1'b1;
	#100 <a  onClick="return qs(event,this,2)"  class=SR href="#14">areset</a> &lt;= 1'b0;
<span class=K>end</span>

<a name="51"></a><span class=K>assign</span> <a  onClick="return qs(event,this,14)"  class=SW href="#26">dram_mem_writeEnable</a> = <a  onClick="return qs(event,this,7)"  class=SW href="#192">mem_writeEnable</a> &amp; ~<a  onClick="return qs(event,this,6)"  class=SW href="#191">mem_addr</a>[ioBit];
<a name="52"></a><span class=K>assign</span> <a  onClick="return qs(event,this,15)"  class=SW href="#27">dram_mem_readEnable</a>  = <a  onClick="return qs(event,this,8)"  class=SW href="#193">mem_readEnable</a> &amp; ~<a  onClick="return qs(event,this,6)"  class=SW href="#191">mem_addr</a>[ioBit];
<a name="53"></a><span class=K>assign</span> <a  onClick="return qs(event,this,20)"  class=SW href="#34">io_mem_writeEnable</a>   = <a  onClick="return qs(event,this,7)"  class=SW href="#192">mem_writeEnable</a> &amp; <a  onClick="return qs(event,this,6)"  class=SW href="#191">mem_addr</a>[ioBit];
<a name="54"></a><span class=K>assign</span> <a  onClick="return qs(event,this,21)"  class=SW href="#35">io_mem_readEnable</a>    = <a  onClick="return qs(event,this,8)"  class=SW href="#193">mem_readEnable</a> &amp; <a  onClick="return qs(event,this,6)"  class=SW href="#191">mem_addr</a>[ioBit];
<a name="55"></a><span class=K>assign</span> <a  onClick="return qs(event,this,3)"  class=SW href="#15">mem_busy</a>             = <a  onClick="return qs(event,this,17)"  class=SW href="#180">io_busy</a>;

<span class=C>// Memory reads either come from IO or DPRAM. We need to pick the right one.
</span><span class=K>always</span> @(<a  onClick="return qs(event,this,12)"  class=SW href="#24">dram_mem_read</a> <span class=K>or</span> <a  onClick="return qs(event,this,22)"  class=SR href="#36">dram_ready</a> <span class=K>or</span> <a  onClick="return qs(event,this,23)"  class=SW href="#37">io_ready</a> <span class=K>or</span> <a  onClick="return qs(event,this,18)"  class=SW href="#30">io_mem_read</a>)
<span class=K>begin</span> : memorycontrol
<a name="60"></a>	<a  onClick="return qs(event,this,4)"  class=SR href="#16">mem_read</a> &lt;= 'hx;
	<span class=K>if</span> (<a  onClick="return qs(event,this,22)"  class=SR href="#36">dram_ready</a> == 1'b1)
	<span class=K>begin</span>
		<a  onClick="return qs(event,this,4)"  class=SR href="#16">mem_read</a> &lt;= <a  onClick="return qs(event,this,12)"  class=SW href="#24">dram_mem_read</a>;
	<span class=K>end</span>
	<span class=K>if</span> (<a  onClick="return qs(event,this,23)"  class=SW href="#37">io_ready</a> == 1'b1)
	<span class=K>begin</span>
		<a  onClick="return qs(event,this,4)"  class=SR href="#16">mem_read</a> &lt;= {wordSize{1'b0}};
		<a  onClick="return qs(event,this,4)"  class=SR href="#16">mem_read</a> &lt;= <a  onClick="return qs(event,this,18)"  class=SW href="#181">io_mem_read</a>;
	<span class=K>end</span>
<span class=K>end</span>

<a name="72"></a><span class=K>assign</span> <a  onClick="return qs(event,this,23)"  class=SW href="#37">io_ready</a> = (<a  onClick="return qs(event,this,24)"  class=SR href="#79">io_reading</a> | <a  onClick="return qs(event,this,21)"  class=SW href="#54">io_mem_readEnable</a>) &amp; ~<a  onClick="return qs(event,this,17)"  class=SW href="#180">io_busy</a>;

<span class=K>always</span> @(<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SR href="#12">clk</a> <span class=K>or</span> <span class=K>posedge</span> <a  onClick="return qs(event,this,2)"  class=SR href="#14">areset</a>)
<span class=K>begin</span> : memoryControlSync
	<span class=K>if</span> (<a  onClick="return qs(event,this,2)"  class=SR href="#14">areset</a> == 1'b1)
	<span class=K>begin</span>
<a name="78"></a>		<a  onClick="return qs(event,this,10)"  class=SR href="#22">enable</a> &lt;= 1'b0;
<a name="79"></a>		<a  onClick="return qs(event,this,24)"  class=SR href="#38">io_reading</a> &lt;= 1'b0;
<a name="80"></a>		<a  onClick="return qs(event,this,22)"  class=SR href="#36">dram_ready</a> &lt;= 1'b0;
	<span class=K>end</span>
	<span class=K>else</span>
	<span class=K>begin</span>
		<a  onClick="return qs(event,this,10)"  class=SR href="#22">enable</a> &lt;= 1'b1;
		<a  onClick="return qs(event,this,24)"  class=SR href="#38">io_reading</a> &lt;= <a  onClick="return qs(event,this,17)"  class=SW href="#180">io_busy</a> | <a  onClick="return qs(event,this,21)"  class=SW href="#54">io_mem_readEnable</a>;
		<a  onClick="return qs(event,this,22)"  class=SR href="#36">dram_ready</a> &lt;= <a  onClick="return qs(event,this,15)"  class=SW href="#52">dram_mem_readEnable</a>;
	<span class=K>end</span>
<span class=K>end</span>

<span class=C>// clock @ 100MHz
</span><span class=K>always</span>
<span class=K>begin</span> : clock
<a name="93"></a>	<a  onClick="return qs(event,this,1)"  class=SR href="#12">clk</a> &lt;= 1'b0;
	#5;
	<a  onClick="return qs(event,this,1)"  class=SR href="#12">clk</a> &lt;= 1'b1;
	#5;
<span class=K>end</span>

<span class=C>// ---------------------------------------------------------------------------
</span><span class=C>// simple printf for debug messages!
</span><span class=C>// this is a replace for io.vhd
</span><a name="102"></a><span class=K>reg</span> [7:0] <a  onClick="return qs(event,this,27)"  class=SR href="#109">char</a>;    <span class=C>// init works only for simulaiton!
</span><a name="103"></a><span class=K>reg</span> [31:0] <a  onClick="return qs(event,this,28)"  class=SR href="#110">io_reg</a>;

<a name="105"></a><span class=K>integer</span> <a  onClick="return qs(event,this,29)"  class=SIT href="#115">file</a>,<a  onClick="return qs(event,this,30)"  class=SIT href="#105">i</a>;
<a name="106"></a><span class=K>reg</span> <a  onClick="return qs(event,this,31)"  class=SR href="#111">put_char</a>;
<span class=K>initial</span>
<span class=K>begin</span>
<a name="109"></a>	<a  onClick="return qs(event,this,27)"  class=SR href="#102">char</a> = 0;
<a name="110"></a>	<a  onClick="return qs(event,this,28)"  class=SR href="#103">io_reg</a> = 0;
<a name="111"></a>	<a  onClick="return qs(event,this,31)"  class=SR href="#106">put_char</a> = 0;
<span class=P>`ifdef VWSIM
</span><span class=P>	file = $fopen(tty_file); </span><span class=P>// veriwell do not support Verilog-2001 $fopen function
</span><span class=M>`else</span>
<a name="115"></a>	<a  onClick="return qs(event,this,29)"  class=SIT href="#105">file</a> = <span class=ST>$fopen</span>(<a  onClick="return qs(event,this,0)"  class=PA href="#10">tty_file</a>,<span class=S>&quot;w&quot;</span>); <span class=C>// open file for write
</span><span class=M>`endif</span>
	<span class=ST>$fdisplay</span>(<a  onClick="return qs(event,this,29)"  class=SIT href="#105">file</a>, <span class=S>&quot;** Starting TTY for ZPU **\n&quot;</span>);
	<span class=C>//$fclose(file);
</span><span class=K>end</span>

<span class=K>always</span> @ (<span class=K>posedge</span> <a  onClick="return qs(event,this,31)"  class=SR href="#106">put_char</a>)
<span class=K>begin</span>
	<a  onClick="return qs(event,this,27)"  class=SR href="#102">char</a> = <a  onClick="return qs(event,this,5)"  class=SW href="#190">mem_write</a>[7:0];
<span class=P>`ifdef VWSIM
</span>	<span class=P>// for veriwell do nothing
</span><span class=M>`else</span>
	<a  onClick="return qs(event,this,29)"  class=SIT href="#105">file</a> = <span class=ST>$fopen</span>(<a  onClick="return qs(event,this,0)"  class=PA href="#10">tty_file</a>,<span class=S>&quot;a&quot;</span>); <span class=C>// open file for apped
</span><span class=M>`endif</span>
	<span class=ST>$fwrite</span>(<a  onClick="return qs(event,this,29)"  class=SIT href="#105">file</a>,<span class=S>&quot;%s&quot;</span>,<a  onClick="return qs(event,this,27)"  class=SR href="#102">char</a>);
<span class=P>`ifdef VWSIM
</span>	<span class=P>// for veriwell do nothing
</span><span class=M>`else</span>
	<span class=ST>$fclose</span>(<a  onClick="return qs(event,this,29)"  class=SIT href="#105">file</a>);                    <span class=C>// close after each char
</span><span class=M>`endif</span>
<span class=K>end</span>

<span class=K>always</span> @ (<span class=K>posedge</span> <a  onClick="return qs(event,this,1)"  class=SR href="#12">clk</a>)
<span class=K>begin</span> : sim_uart_proc
	<a  onClick="return qs(event,this,31)"  class=SR href="#106">put_char</a> = 0;
<a name="140"></a>	<a  onClick="return qs(event,this,19)"  class=SR href="#32">io_mem_read_reg</a> &lt;= 'h0;
	<span class=K>if</span> ( <a  onClick="return qs(event,this,20)"  class=SW href="#34">io_mem_writeEnable</a> == 1 )
	<span class=K>begin</span>
		<span class=K>case</span> (<a  onClick="return qs(event,this,6)"  class=SW href="#18">mem_addr</a>)
		<span class=C>// -- external interface (fixed address) used by printf C function adr: 0x80a000c : io_adr 0028003
</span>		'h80a000c :
			<span class=K>begin</span>
				<a  onClick="return qs(event,this,31)"  class=SR href="#106">put_char</a> = 1;
				<span class=C>// $display(&quot;[INFO tb_zpu_core]: TTY CHAR %s &quot;,mem_write);
</span>			<span class=K>end</span>
		<span class=K>default</span>:
			<span class=K>begin</span>
				<span class=ST>$display</span>(<span class=S>&quot;[INFO tb_zpu_core] WRITE: ADR: %h -  IO_ADR: %h  - DATA: %h &quot;</span>,<a  onClick="return qs(event,this,6)"  class=SW href="#18">mem_addr</a>,<a  onClick="return qs(event,this,26)"  class=SW href="#42">io_mem_addr</a>,<a  onClick="return qs(event,this,5)"  class=SW href="#17">mem_write</a>);
				<a  onClick="return qs(event,this,28)"  class=SR href="#103">io_reg</a> &lt;= <a  onClick="return qs(event,this,5)"  class=SW href="#190">mem_write</a>;
			<span class=K>end</span>
		<span class=K>endcase</span>
	<span class=K>end</span>

	<span class=K>if</span> ( <a  onClick="return qs(event,this,21)"  class=SW href="#35">io_mem_readEnable</a> == 1 )
	<span class=K>begin</span>
		<span class=K>case</span> (<a  onClick="return qs(event,this,6)"  class=SW href="#18">mem_addr</a>)
		'h0001001 :
			<span class=K>begin</span>
				<a  onClick="return qs(event,this,19)"  class=SR href="#32">io_mem_read_reg</a> &lt;= 'h0;
				<span class=C>// $display(&quot;[INFO tb_zpu_core]: READ: recieve empty adr: %h  data: %h&quot;,mem_addr,io_mem_read);
</span>			<span class=K>end</span>
		'h80a000c :
			<span class=K>begin</span>
				<a  onClick="return qs(event,this,19)"  class=SR href="#32">io_mem_read_reg</a> &lt;= 'h100;
				<span class=C>// $display(&quot;[INFO tb_zpu_core]: READ: TTY  adr: %h  data: %h&quot;,mem_addr, io_mem_read);
</span>			<span class=K>end</span>
		<span class=K>default</span>:
			<span class=K>begin</span>
				<a  onClick="return qs(event,this,19)"  class=SR href="#32">io_mem_read_reg</a> &lt;= <a  onClick="return qs(event,this,28)"  class=SR href="#110">io_reg</a>;
				<span class=ST>$display</span>(<span class=S>&quot;[INFO tb_zpu_core]  READ: ADR: %h -  IO_ADR: %h  - DATA: %h &quot;</span>,<a  onClick="return qs(event,this,6)"  class=SW href="#18">mem_addr</a>,<a  onClick="return qs(event,this,26)"  class=SW href="#42">io_mem_addr</a>,<a  onClick="return qs(event,this,28)"  class=SR href="#103">io_reg</a>);
			<span class=K>end</span>
		<span class=K>endcase</span>
	<span class=K>end</span>
<span class=K>end</span>

<a name="180"></a><span class=K>assign</span> <a  onClick="return qs(event,this,17)"  class=SW href="#29">io_busy</a> = <a  onClick="return qs(event,this,21)"  class=SW href="#54">io_mem_readEnable</a>;
<a name="181"></a><span class=K>assign</span> <a  onClick="return qs(event,this,18)"  class=SW href="#30">io_mem_read</a> = <a  onClick="return qs(event,this,19)"  class=SR href="#140">io_mem_read_reg</a>;


<a name="tb_zpu_core_zpu_core_i"></a><a  onClick="return qs(event,this,0)"  class=MM href="zpu_core.v.html#zpu_core">zpu_core</a> zpu_core_i (
<a name="185"></a>	<span class=SI>.clk</span>                 (<a  onClick="return qs(event,this,1)"  class=SR href="#93">clk</a>),
<a name="186"></a>	<span class=SI>.areset</span>              (<a  onClick="return qs(event,this,2)"  class=SR href="#47">areset</a>),
<a name="187"></a>	<span class=SI>.enable</span>              (<a  onClick="return qs(event,this,10)"  class=SR href="#78">enable</a>),
<a name="188"></a>	<span class=SI>.in_mem_busy</span>         (<a  onClick="return qs(event,this,3)"  class=SW href="#55">mem_busy</a>),
<a name="189"></a>	<span class=SI>.mem_read</span>            (<a  onClick="return qs(event,this,4)"  class=SR href="#60">mem_read</a>),
<a name="190"></a>	<a  onClick="return qs(event,this,0)"  class=SOR href="zpu_core.v.html#203">.mem_write</a>           (<a  onClick="return qs(event,this,5)"  class=SW href="#17">mem_write</a>),
<a name="191"></a>	<a  onClick="return qs(event,this,0)"  class=SOR href="zpu_core.v.html#202">.out_mem_addr</a>        (<a  onClick="return qs(event,this,6)"  class=SW href="#18">mem_addr</a>),
<a name="192"></a>	<a  onClick="return qs(event,this,0)"  class=SOR href="zpu_core.v.html#183">.out_mem_writeEnable</a> (<a  onClick="return qs(event,this,7)"  class=SW href="#19">mem_writeEnable</a>),
<a name="193"></a>	<a  onClick="return qs(event,this,0)"  class=SOR href="zpu_core.v.html#184">.out_mem_readEnable</a>  (<a  onClick="return qs(event,this,8)"  class=SW href="#20">mem_readEnable</a>),
<a name="194"></a>	<a  onClick="return qs(event,this,0)"  class=SO href="zpu_core.v.html#127">.mem_writeMask</a>       (<a  onClick="return qs(event,this,9)"  class=SW href="#21">mem_writeMask</a>),
	<span class=SI>.interrupt</span>           (1'b0),
<a name="196"></a>	<a  onClick="return qs(event,this,0)"  class=SOR href="zpu_core.v.html#174">.break</a>               (<a  onClick="return qs(event,this,25)"  class=SW href="#39">break</a>)
);

<span class=K>endmodule</span>

</pre>
<center><table class=NB cols=7 ><tr><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy.html';"><a target="_top" href="hierarchy.html">Hierarchy</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-f.html';"><a target="_top" href="hierarchy-f.html">Files</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-m.html';"><a target="_top" href="hierarchy-m.html">Modules</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-s.html';"><a target="_top" href="hierarchy-s.html">Signals</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-t.html';"><a target="_top" href="hierarchy-t.html">Tasks</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='hierarchy-fn.html';"><a target="_top" href="hierarchy-fn.html">Functions</a></td><td align="center" width="14%" onmousedown="this.style.border='inset';" onmouseup="this.style.border='outset';"  onclick="location='http://www.burbleland.com/v2html/help_7_30.html?';"><a target="_top" href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></td></tr></table></center>
<script language="JavaScript"type="text/javascript"><!--
function next_page() { return ""; }
function first_page() { return ""; }
var extra_info = [
["S","tb_zpu_core.v.html#12","tb_zpu_core.v.html#93","","tb_zpu_core.v.html#93","hierarchy-s.html#clk___tb_zpu_core"],
["S","tb_zpu_core.v.html#14","tb_zpu_core.v.html#47","","tb_zpu_core.v.html#47","hierarchy-s.html#areset___tb_zpu_core"],
["S","tb_zpu_core.v.html#15","tb_zpu_core.v.html#55","","tb_zpu_core.v.html#55","hierarchy-s.html#mem_busy___tb_zpu_core"],
["S","tb_zpu_core.v.html#16","tb_zpu_core.v.html#60","","tb_zpu_core.v.html#60","hierarchy-s.html#mem_read___tb_zpu_core"],
["S","tb_zpu_core.v.html#17","tb_zpu_core.v.html#190","","zpu_core.v.html#203","hierarchy-s.html#mem_write___tb_zpu_core"],
["S","tb_zpu_core.v.html#18","tb_zpu_core.v.html#191","","zpu_core.v.html#202","hierarchy-s.html#mem_addr___tb_zpu_core"],
["S","tb_zpu_core.v.html#19","tb_zpu_core.v.html#192","","zpu_core.v.html#183","hierarchy-s.html#mem_writeEnable___tb_zpu_core"],
["S","tb_zpu_core.v.html#20","tb_zpu_core.v.html#193","","zpu_core.v.html#184","hierarchy-s.html#mem_readEnable___tb_zpu_core"],
["S","tb_zpu_core.v.html#21","tb_zpu_core.v.html#194","","zpu_core.v.html#127","hierarchy-s.html#mem_writeMask___tb_zpu_core"],
["S","tb_zpu_core.v.html#22","tb_zpu_core.v.html#78","","tb_zpu_core.v.html#78","hierarchy-s.html#enable___tb_zpu_core"],
["S","tb_zpu_core.v.html#23","","","","hierarchy-s.html#dram_mem_busy___tb_zpu_core"],
["S","tb_zpu_core.v.html#24","","","","hierarchy-s.html#dram_mem_read___tb_zpu_core"],
["S","tb_zpu_core.v.html#25","","","","hierarchy-s.html#dram_mem_write___tb_zpu_core"],
["S","tb_zpu_core.v.html#26","tb_zpu_core.v.html#51","","tb_zpu_core.v.html#51","hierarchy-s.html#dram_mem_writeEnable___tb_zpu_core"],
["S","tb_zpu_core.v.html#27","tb_zpu_core.v.html#52","","tb_zpu_core.v.html#52","hierarchy-s.html#dram_mem_readEnable___tb_zpu_core"],
["S","tb_zpu_core.v.html#28","","","","hierarchy-s.html#dram_mem_writeMask___tb_zpu_core"],
["S","tb_zpu_core.v.html#29","tb_zpu_core.v.html#180","","tb_zpu_core.v.html#180","hierarchy-s.html#io_busy___tb_zpu_core"],
["S","tb_zpu_core.v.html#30","tb_zpu_core.v.html#181","","tb_zpu_core.v.html#181","hierarchy-s.html#io_mem_read___tb_zpu_core"],
["S","tb_zpu_core.v.html#32","tb_zpu_core.v.html#140","","tb_zpu_core.v.html#140","hierarchy-s.html#io_mem_read_reg___tb_zpu_core"],
["S","tb_zpu_core.v.html#34","tb_zpu_core.v.html#53","","tb_zpu_core.v.html#53","hierarchy-s.html#io_mem_writeEnable___tb_zpu_core"],
["S","tb_zpu_core.v.html#35","tb_zpu_core.v.html#54","","tb_zpu_core.v.html#54","hierarchy-s.html#io_mem_readEnable___tb_zpu_core"],
["S","tb_zpu_core.v.html#36","tb_zpu_core.v.html#80","","tb_zpu_core.v.html#80","hierarchy-s.html#dram_ready___tb_zpu_core"],
["S","tb_zpu_core.v.html#37","tb_zpu_core.v.html#72","","tb_zpu_core.v.html#72","hierarchy-s.html#io_ready___tb_zpu_core"],
["S","tb_zpu_core.v.html#38","tb_zpu_core.v.html#79","","tb_zpu_core.v.html#79","hierarchy-s.html#io_reading___tb_zpu_core"],
["S","tb_zpu_core.v.html#39","tb_zpu_core.v.html#196","","zpu_core.v.html#174","hierarchy-s.html#break___tb_zpu_core"],
["S","tb_zpu_core.v.html#42","tb_zpu_core.v.html#43","","tb_zpu_core.v.html#43","hierarchy-s.html#io_mem_addr___tb_zpu_core"],
["S","tb_zpu_core.v.html#102","tb_zpu_core.v.html#109","","tb_zpu_core.v.html#109","hierarchy-s.html#char___tb_zpu_core"],
["S","tb_zpu_core.v.html#103","tb_zpu_core.v.html#110","","tb_zpu_core.v.html#110","hierarchy-s.html#io_reg___tb_zpu_core"],
["S","tb_zpu_core.v.html#105","tb_zpu_core.v.html#115","","tb_zpu_core.v.html#115","hierarchy-s.html#file___tb_zpu_core"],
["S","tb_zpu_core.v.html#105","","","","hierarchy-s.html#i___tb_zpu_core"],
["S","tb_zpu_core.v.html#106","tb_zpu_core.v.html#111","","tb_zpu_core.v.html#111","hierarchy-s.p2.html#put_char___tb_zpu_core"]
];
disabled=0;
// -->
</script>
<hr>
<table>
 <tr><td><i>This page:</i></td>
  <td><i>Created:</i></td><td><i>Wed May  7 19:53:06 2008</i></td></tr>
<tr>
 <td> </td>
 <td><i>From:</i></td><td><i>
../../tb/hdl/tb_zpu_core.v</i></td></tr>
</table>
<hr>
<table width="100%"><tr><td><i>Verilog converted to html by  <a target="_top" href="http://www.burbleland.com/v2html/v2html.html">  v2html 7.30</a> 
 (written by <a href="mailto:v2html730@burbleland.com">Costas Calamvokis</a>).</i></td><td align="right"><b><a href="http://www.burbleland.com/v2html/help_7_30.html?">Help</a></b></td></tr></table><table height="90%"><tr><td></td></tr></table>
</body>
</html>
