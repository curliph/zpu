<html>
<body>
<h1>Index</h1>
<ul>
<li> <a href="#introduction">Introduction</a>
<li> <a href="#instructionset">Instruction set</a>
<li> <a href="#vectors">Jump vectors</a>
<li> <a href="#memorymap">Memory map</a>
<li> <a href="#interrupts">Interrupts</a>
</ul>
<a name="introduction"/>
<h1>Introduction</h1>
The ZPU is a zero operand, or stack based CPU. The opcodes have a fixed width of 8 bits. 
<p>
Example:
<p>
<div style="white-space:pre;background-color:#dddddd;">
	<code style="white-space:pre;background-color:#dddddd;">
		IM 5                ; push 5 onto the stack
		LOADSP 20           ; push value at memory location SP+20
		ADD                 ; pop 2 values on the stack and push the result
	</code>
</div>
As can be seen, a lot of information is packed into the 8 bits, e.g. the IM instruction pushes a 7 bit signed integer onto the stack. 
<p>
The choice of opcodes is intimately tied to the GCC toolchain capabilities.
<p>
<div style="white-space:pre;background-color:#dddddd;">
	<code style="white-space:pre;background-color:#dddddd;">
	/* simple program showing some interesting qualities of the ZPU toolchain */
	void bar(int);
	int j;
	void foo(int a, int b, int c)
	{
	  a++;
	  b+=a;
	  j=c;
	  bar(b);
	}

foo:
 loadsp 4	; a is at memory location SP+4
 im 1
 add
 loadsp 12	; b is now at memory location SP+12
 add
 loadsp 16	; c is now at memory location SP+16
 im 24		; «j» is at absolute memory location 24. 
; Notice how the ZPU toolchain is using link-time relaxation
; to squeeze the address into a single no-op
 store
 im 22		; the fn bar is at address 22
 call
 im 12
 return	; 12 bytes of arguments + return from fn
</code>
</div>

<a name="instructionset"/>
<h1>Instruction set</h1>
Only the base instructions are implemented in the architecture. More advanced instructions, like ASHIFTLEFT are emulated in the illegal instruction vector.

All operations are 32 bit wide.
<table border="1">
	<tr><td>Name</td><td>Opcode</td><td>Description</td><td>Definition</td></tr>
	<tr>
		<td>
			BREAKPOINT
		</td>
		<td>
			00000000
		</td>
		<td>
			The debugger sets a memory location to this value to set a breakpoint. Once a JTAG-like 
			debugger interface is added, it will be convenient to be able to distinguish 
			between a breakpoint and an illegal(possibly emulated) instruction.
		</td>
		<td>
			No effect on registers
		</td>
	</tr>
	<tr>
		<td>
			IM
		</td>
		<td>
			1xxx xxxx
		</td>
		<td>
			Pushes 7 bit sign extended integer and sets the a «instruction decode interrupt mask» flag(IDIM).
			<p> 
			If the IDIM flag is already set, this instruction shifts the value on the stack left by 7 bits and stores the 7 bit immediate value into the lower 7 bits.
			<p> 
			Unless an instruction is listed as treating the IDIM flag specially, it should be assumed to clear the IDIM flag.
			<p> 
			To push a 14 bit integer onto the stack, use two consequtive IM instructions. 
			<p> 
			If multiple immediate integers are to be pushed onto the stack, they must be interleaved with another instruction, typically NOP.
		</td>
		<td>
			<code style="white-space:pre;">
pc <= pc + 1 <br>
idim <= 1 <br>
if (idim=0) then <br>
	sp <= sp - 1; <br>
	for i in wordSize-1 downto 7 loop <br>
		mem(sp)(i) <= opcode(6) <br>
	end loop <br>
	mem(sp)(6 downto 0) <= opcode(6 downto 0) <br>
else <br>
	mem(sp)(wordSize-1 downto 7) <= mem(sp)(wordSize-8 downto 0) <br>
	mem(sp)(6 downto 0) <= opcode(6 downto 0) <br>
end if
			</code>

		</td>
	</tr>
	<tr>
		<td>
			STORESP
		</td>
		<td>
			010x xxxx
		</td>
		<td>
			Pop value off stack and store it in the SP+xxxxx*4 memory location, where xxxxx is a positive integer.
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			LOADSP
		</td>
		<td>
			011x xxxx
		</td>
		<td>
			Push value of memory location SP+xxxxx*4, where xxxxx is a positive integer, onto stack.
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			ADDSP
		</td>
		<td>
			0001 xxxx
		</td>
		<td>
			Add value of memory location SP+xxxx*4 to value on top of stack.
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			EMULATE
		</td>
		<td>
			001x xxxx
		</td>
		<td>
			Push PC to stack and set PC to 0x0+xxxxx*32. This is used to emulate opcodes. See zpupgk.vhd for list of emulate opcode values used. zpu_core.vhd contains reference implementations of these instructions rather than letting the ZPU execute the EMULATE instruction
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			PUSHPC
		</td>
		<td>
			emulated
		</td>
		<td>
			Pushes program counter onto the stack.
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			POPPC
		</td>
		<td>
			0000 0100
		</td>
		<td>
			Pops address off stack and sets PC
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			LOAD
		</td>
		<td>
			0000 1000
		</td>
		<td>
			Pops address stored on stack and loads the value of that address onto stack.
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			LOAD
		</td>
		<td>
			0000 1000
		</td>
		<td>
			Pops address stored on stack and loads the value of that address onto stack.
			<p>
			Bit 0 and 1 of address are always 0.
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			STORE
		</td>
		<td>
			0000 1100
		</td>
		<td>
			Pops address, then value from stack and stores the value into the memory location of the address.
			<p>
			Bit 0 and 1 of address are always 0
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			PUSHSP
		</td>
		<td>
			0000 0010
		</td>
		<td>
			Pushes stack pointer. 
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			POPSP
		</td>
		<td>
			0000 1101
		</td>
		<td>
			Used to allocate/deallocate space on stack for variables or when changing threads. 
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			ADD
		</td>
		<td>
			0000 0101
		</td>
		<td>
			Pops two values on stack adds them and pushes the result
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			AND
		</td>
		<td>
			0000 0110
		</td>
		<td>
			Pops two values off the stack and does a bitwise-and & pushes the result onto the stack
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			OR
		</td>
		<td>
			0000 0111
		</td>
		<td>
			Pops two integers, does a bitwise or and pushes result
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			NOT
		</td>
		<td>
			0000 1001
		</td>
		<td>
			Bitwise inverse of value on stack

		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			FLIP
		</td>
		<td>
			0000 1010
		</td>
		<td>
			Reverses the bit order of the value on the stack, i.e. abc->cba, 100->001, 110->011, etc. 
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			NOP
		</td>
		<td>
			0000 1011
		</td>
		<td>
			No operation
		</td>
		<td>
			Fix!
		</td>
	</tr>
	<tr>
		<td>
			Fix! add emulated instructions! Listed in zpupkg.vhd
		</td>
		<td>
			001x xxxx
		</td>
		<td>
			Fix!!
		</td>
		<td>
			Fix!
		</td>
	</tr>
</table>
	
<a name="vectors"/>
<h1>Vectors</h1>
<table border="1">
	<tr><td>Address</td><td>Name</td><td>Description</td></tr>
	<tr>
		<td>0x000</td>
		<td>Reset</td>
		<td>
			1.When the ZPU boots, this is the first instruction to be executed.
			<p>
			2.The stack pointer is initialised to maximum RAM address
			</td>
	</tr>
	<tr>
		<td>0x020</td>
		<td>Interrupt</td>
		<td>
			This is the entry point for interrupts.
		</td>
	</tr>
	<tr>
		<td>0x040-</td>
		<td>Emulated instructions</td>
		<td>
			Emulated opcode 34. Note that opcode 32 and opcode 33 are not normally used to emulate instructions as these memory addresses are already used by boot vector, GCC registers and the interrupt vector.
		</td>
	</tr>
</table>

<a name="memorymap"/>
<h1>Phi memory map</h1>
The ZPU architecture does not define a memory map as such, but the GCC + libgloss + ecos hal library uses the
memory map below.
<p>
	<TABLE WIDTH=604 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=7 CELLSPACING=0 STYLE="page-break-after: avoid">
		<COL WIDTH=85>
		<COL WIDTH=42>
		<COL WIDTH=136>
		<COL WIDTH=283>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2><B>Address</B></FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2><B>Type</B></FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2><B>Name</B></FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2><B>Description</B></FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0000</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">ZPU
				enable</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:1] Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]	Enable ZPU operations</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	ZPU
				is held in Idle mode</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	ZPU
				running</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A000C</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read/</FONT></FONT></P>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">ZPU
				UART to ARM7 TX</FONT></FONT></P>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>NOTE!
				ZPU side</B></FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:9] Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[8]	TX buffer ready (valid on ready)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	TX
				buffer not ready (full)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	TX
				buffer ready</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[7:0]	TX byte (valid on write)</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0010</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">ZPU
				UART to ARM7 RX</FONT></FONT></P>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>NOTE!
				ZPU side</B></FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:9] Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[8]	RX buffer data valid</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	TX
				buffer not valid</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	TX
				buffer valid</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[7:0]	RX byte (when valid)</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0014</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read/</FONT></FONT></P>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Counter(1)</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]	Reset counter (valid for write)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	N/A</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Reset
				counter</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[1]	Sample counter (valid for write)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	N/A</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Sample
				counter</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:0]		Counter bit 31:0</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0018</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Counter(2)</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:0]		Counter bit 63:32</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0020</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read
				/ Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Global_Interrupt_mask</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:1]		Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		Global intr. Mask</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	Interrupts
				enabled</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupts
				disabled</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0024</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">UART_INTERRUPT_ENABLE</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:1]		Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		UART RX interrupt enable</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	Interrupt
				disable</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupt
				enable</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0028</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read</FONT></FONT></P>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">UART_interrupt</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:1]		Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		UART RX interrupt pending (Read)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	No
				interrupt pending</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupt
				pending</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		Clear UART interrupt (Write)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	N/A</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupt
				cleared</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A002C</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Timer_Interrupt_enable</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:1]		Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		Timer interrupt  enable</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	Interrupt
				disable</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupt
				enable</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0030</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read
				/</FONT></FONT></P>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Timer_interrupt</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:2]		Not used</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		Timer interrupt pending (Read)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	No
				interrupt pending</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupt
				pending</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[1]		Reset Timer counter (Write)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	N/A</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Timer
				counter reset</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[0]		Clear Timer interrupt (Write)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	0	N/A</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">	1	Interrupt
				cleared</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">0x080A0034</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Write</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Timer_Period</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:0]		Interrupt period (write)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">		Number
				of clock cycles</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">		between
				timer interrupts</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt"><B>NOTE!
				</B>The timer will start at Timer_Periode value and count <B>down</B>
				to zero, and generate an interrupt</FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">.0x080A0038</FONT></FONT></P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Read</FONT></FONT></P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Timer_Counter</FONT></FONT></P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><FONT FACE="Arial, sans-serif"><FONT SIZE=2 STYLE="font-size: 9pt">Bit
				[31:0]		Timer counter (read)</FONT></FONT></P>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=85>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
			<TD WIDTH=42>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=136>
				<P LANG="en-US" CLASS="western" ALIGN=CENTER><BR>
				</P>
			</TD>
			<TD WIDTH=283>
				<P LANG="en-US" CLASS="western"><BR>
				</P>
			</TD>
		</TR>
	</TABLE>
<a name="interrupts"/>
<h1>Interrupts</h1>
The ZPU supports interrupts.
<p>
To trigger an interrupt, the interrupt signal must be asserted. The ZPU does
not define any interrupt disabling mechanism, this must be implemented by the
interrupt controller and controlled via memory mapped IO.
<p>
Interrupts are masked when the IDIM flag is set, i.e.
with consequtive IM instructions.
<p>
The ZPU has an edge triggered interrupt. As the ZPU notices that the interrupt
is asserted, it will execute the interrupt instruction. The interrupt signal
must stay asserted until the ZPU acknowledges it. 
<p>
When the interrupt instruction is executed, the PC will be pushed onto the
stack and the PC will be set to the interrupt vector address (0x20).
<p>
Note that the GCC compiler requires three registers r0,r1,r2,r3 for some
rather uncommon operations. These 32 registers are mapped to memory locations 0x0,
0x4, 0x8, 0xc.  The default interrupt vector at address 0x20 will load the
value of these memory locations onto the stack, call _zpu_interrupt and
restore them.
</body>
<html>